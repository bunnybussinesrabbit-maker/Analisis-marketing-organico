# ğŸ“Š Diagrama de Flujo - Sistema de AnÃ¡lisis CSV

## 1. FLUJO DE CARGA Y NORMALIZACIÃ“N

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USUARIO SUBE CSV                            â”‚
â”‚              Click: "Cargar Archivo CSV"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    handleFiles(event)                           â”‚
â”‚  â€¢ Valida que sea .csv                                          â”‚
â”‚  â€¢ Valida MIME type                                             â”‚
â”‚  â€¢ Inicia Papa.parse()                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Papa.parse(file, config)                           â”‚
â”‚  â€¢ header: true                                                 â”‚
â”‚  â€¢ skipEmptyLines: true                                         â”‚
â”‚  â€¢ Retorna: results.data (array de objetos)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PASO 1: MAPEO DE HEADERS                              â”‚
â”‚                                                                  â”‚
â”‚  Para cada header en CSV:                                       â”‚
â”‚    csvHeader â†’ FieldMapper.detectField(csvHeader)               â”‚
â”‚      â”œâ”€ Tier 1: BÃºsqueda exacta                                 â”‚
â”‚      â”œâ”€ Tier 2: BÃºsqueda fuzzy                                  â”‚
â”‚      â””â”€ Tier 3: Keyword matching                                â”‚
â”‚    â†’ Retorna: canonical field name                              â”‚
â”‚                                                                  â”‚
â”‚  Ejemplo:                                                        â”‚
â”‚    "TIPO_PITCH" â†’ "pitchType"                                   â”‚
â”‚    "resultado" â†’ "result"                                       â”‚
â”‚    "zona_id"   â†’ "zone"                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PASO 2: NORMALIZACIÃ“N DE VALORES                        â”‚
â”‚                                                                  â”‚
â”‚  processData(rawData, headerMap)                                â”‚
â”‚                                                                  â”‚
â”‚  Para cada registro:                                            â”‚
â”‚    1. Mapear headers usando headerMap                           â”‚
â”‚    2. Buscar en mÃºltiples aliases                               â”‚
â”‚       (pitchtype, pitch_type, tipo_pitch, etc.)                â”‚
â”‚    3. Normalizar valor con VALUE_NORMALIZERS:                  â”‚
â”‚                                                                  â”‚
â”‚       pitchType("autoridad") â†’ "autoridad"                     â”‚
â”‚       pitchType("Autoridad") â†’ "autoridad"  (lowercase)        â”‚
â”‚       pitchType("AUTHORITY") â†’ "autoridad"  (fuzzy)            â”‚
â”‚       pitchType("experto") â†’ "autoridad"    (variant)          â”‚
â”‚                                                                  â”‚
â”‚    4. Normalizar acentos:                                       â”‚
â”‚       "AutorÃ­dad" â†’ normalize('NFD') â†’ "autoridad"             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PASO 3: VALIDACIÃ“N Y TRACKING DE PROBLEMAS             â”‚
â”‚                                                                  â”‚
â”‚  Si zona === 'unknown' â•‘ pitchType === 'unknown':              â”‚
â”‚    â†’ Agregar a problemRecords[]                                 â”‚
â”‚    â†’ Guardar originalRow para debugging                         â”‚
â”‚    â†’ Loguear en consola                                         â”‚
â”‚                                                                  â”‚
â”‚  Resultado:                                                      â”‚
â”‚    problemRecords: [                                             â”‚
â”‚      {                                                           â”‚
â”‚        index: 5,                                                â”‚
â”‚        originalRow: {zona: "unknown", ...},                     â”‚
â”‚        normalizedRow: {...},                                    â”‚
â”‚        issues: {zona: true, pitchType: false}                  â”‚
â”‚      }                                                           â”‚
â”‚    ]                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PASO 4: CREAR OBJETOS DE VENTA NORMALIZADOS                â”‚
â”‚                                                                  â”‚
â”‚  const venta = {                                                â”‚
â”‚    zona: "zona_hotelera",        â† Normalizado                  â”‚
â”‚    pitchType: "autoridad",       â† Normalizado                  â”‚
â”‚    result: "successful",         â† Normalizado                  â”‚
â”‚    clientOrigin: "CDMX",         â† Normalizado                  â”‚
â”‚    age: "36-45",                 â† Si existe                    â”‚
â”‚    occupation: "profesional",    â† Si existe                    â”‚
â”‚    income: "alto",               â† Normalizado                  â”‚
â”‚    lat: 21.135, lng: -86.745,    â† GPS                          â”‚
â”‚    monto: 450,                   â† Parsead                      â”‚
â”‚    fecha: Date,                                                  â”‚
â”‚    _rawData: {...}               â† Original para debug          â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  window.salesData.push(venta)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PASO 5: SINCRONIZACIÃ“N Y ACTIVACIÃ“N                      â”‚
â”‚                                                                  â”‚
â”‚  window.filteredData = [...window.salesData]                    â”‚
â”‚                                                                  â”‚
â”‚  updateStatistics()  â† Actualiza contadores                     â”‚
â”‚  updateTable()       â† Actualiza tabla                          â”‚
â”‚  updateCharts()      â† Actualiza grÃ¡ficos                       â”‚
â”‚                                                                  â”‚
â”‚  syncCapturedDataWithAnalytics()                                â”‚
â”‚    â”œâ”€ Agregar datos capturados manualmente                      â”‚
â”‚    â””â”€ Trigger: initCompleteAnalysis() si estÃ¡ disponible        â”‚
â”‚                                                                  â”‚
â”‚  showNotification("âœ… X ventas cargadas")                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              âœ… CSV PROCESADO EXITOSAMENTE                      â”‚
â”‚                                                                  â”‚
â”‚  window.salesData: [100+ objetos normalizados]                  â”‚
â”‚  window.filteredData: [100+ objetos normalizados]               â”‚
â”‚  Fichero: Listo para anÃ¡lisis                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUJO DE ANÃLISIS CRUZADO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         USUARIO NAVEGA A "ANÃLISIS CRUZADO"                     â”‚
â”‚               Click: Tab "AnÃ¡lisis Cruzado"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          TRIGGER: switchView('complete-analysis')               â”‚
â”‚                                                                  â”‚
â”‚  if (filteredData.length > 0):                                  â”‚
â”‚    â†’ setTimeout(initCompleteAnalysis, 100ms)                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              initCompleteAnalysis()                             â”‚
â”‚                                                                  â”‚
â”‚  1. sincronizarAnalisis()                                       â”‚
â”‚     â”œâ”€ Normalizar datos con FieldMapper                         â”‚
â”‚     â”œâ”€ Crear CrossDimensionalAnalyzer                           â”‚
â”‚     â””â”€ Validar datos demogrÃ¡ficos                               â”‚
â”‚                                                                  â”‚
â”‚  2. renderDemographicAnalysis()                                 â”‚
â”‚     â”œâ”€ Poblar select de ocupaciones                             â”‚
â”‚     â”œâ”€ Poblar select de zonas  â† LAS OPCIONES REALES            â”‚
â”‚     â”œâ”€ Poblar select de pitch types (ya definido)               â”‚
â”‚     â””â”€ Renderizar visualizaciÃ³n inicial                         â”‚
â”‚                                                                  â”‚
â”‚  3. renderOriginAnalysis()                                      â”‚
â”‚     â”œâ”€ AnÃ¡lisis por origen del cliente                          â”‚
â”‚     â””â”€ Matriz: clientOrigin Ã— pitchType Ã— zone                  â”‚
â”‚                                                                  â”‚
â”‚  4. setupAnalysisEventListeners()                               â”‚
â”‚     â”œâ”€ Click: Botones de filtro                                 â”‚
â”‚     â”œâ”€ Change: Selects de filtro                                â”‚
â”‚     â””â”€ Click: Toggle de visualizaciÃ³n (heatmap/tabla)           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          âœ… ANÃLISIS CRUZADO LISTO PARA USAR                    â”‚
â”‚                                                                  â”‚
â”‚  Filtros visibles:                                              â”‚
â”‚    â€¢ Edad âœ…                                                    â”‚
â”‚    â€¢ OcupaciÃ³n âœ…                                               â”‚
â”‚    â€¢ Ingreso âœ…                                                 â”‚
â”‚    â€¢ Zona âœ… (poblado con datos reales)                         â”‚
â”‚    â€¢ Tipo de Pitch âœ… (poblado con datos reales)                â”‚
â”‚                                                                  â”‚
â”‚  Matrices disponibles:                                          â”‚
â”‚    â€¢ DemogrÃ¡fico: edad Ã— ocupaciÃ³n Ã— ingreso â†’ conversiÃ³n      â”‚
â”‚    â€¢ Origen: origen Ã— pitch Ã— zona â†’ conversiÃ³n                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FLUJO DE DEBUGGING

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         USUARIO VE "UNKNOWN" EN FILTROS                         â”‚
â”‚              Abre DevTools (F12)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 1: Ejecutar diagnÃ³stico                                   â”‚
â”‚  window.debugCSVData()                                          â”‚
â”‚                                                                  â”‚
â”‚  Output:                                                         â”‚
â”‚    window.salesData: 100 registros                              â”‚
â”‚    âš ï¸ 5 registros con "unknown"                                 â”‚
â”‚    [5]: Registro problemÃ¡tico                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 2: Investigar registros problemÃ¡ticos                     â”‚
â”‚                                                                  â”‚
â”‚  const unknowns = window.salesData.filter(r =>                  â”‚
â”‚    r.zona === 'unknown' || r.pitchType === 'unknown'            â”‚
â”‚  );                                                              â”‚
â”‚                                                                  â”‚
â”‚  unknowns.forEach(r => {                                        â”‚
â”‚    console.log('Original:', r._rawData);                        â”‚
â”‚    console.log('Normalizado:', r);                              â”‚
â”‚  });                                                             â”‚
â”‚                                                                  â”‚
â”‚  Output ejemplo:                                                â”‚
â”‚    Original: {zona: "hotelera", ...}                            â”‚
â”‚    Normalizado: {zona: "unknown", ...}                          â”‚
â”‚                                                                  â”‚
â”‚  â†’ ENCONTRADO: "hotelera" no fue mapeado a "zona_hotelera"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 3: Corregir en fieldMapper.js                             â”‚
â”‚                                                                  â”‚
â”‚  UbicaciÃ³n: utils/fieldMapper.js, zona normalizer               â”‚
â”‚                                                                  â”‚
â”‚  Agregar variante:                                              â”‚
â”‚    'hotelera': 'zona_hotelera',                                 â”‚
â”‚                                                                  â”‚
â”‚  Antes:                                                          â”‚
â”‚    "hotelera" â†’ normalize() â†’ "hotelera" â†’ zoneMap              â”‚
â”‚      â†’ "unknown" (no coincidencia)                              â”‚
â”‚                                                                  â”‚
â”‚  DespuÃ©s:                                                        â”‚
â”‚    "hotelera" â†’ normalize() â†’ "hotelera" â†’ zoneMap              â”‚
â”‚      â†’ "zona_hotelera" (coincidencia!)                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 4: Recargar datos                                         â”‚
â”‚                                                                  â”‚
â”‚  location.reload()  â† Recargar pÃ¡gina                           â”‚
â”‚                                                                  â”‚
â”‚  O si tienes datos en memoria:                                  â”‚
â”‚    delete window.salesData;                                     â”‚
â”‚    handleFiles(fileInput);  â† Recargar CSV                      â”‚
â”‚                                                                  â”‚
â”‚  Luego verificar:                                               â”‚
â”‚    window.debugCSVData()  â† DeberÃ­a ver 0 "unknown"             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              âœ… PROBLEMA SOLUCIONADO                            â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Todos los registros normalizados                             â”‚
â”‚  â€¢ Filtros muestran valores reales                              â”‚
â”‚  â€¢ AnÃ¡lisis funciona correctamente                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ARQUITECTURA DE CLASES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   window.FieldMapper       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FIELD_MAP: Object          â”‚ 100+ mappings
â”‚ VALUE_NORMALIZERS: Object  â”‚
â”‚ â”œâ”€ result()               â”‚ â†’ successful|failed|pending
â”‚ â”œâ”€ pitchType()            â”‚ â†’ autoridad|nostalgia|escasez|comunidad
â”‚ â”œâ”€ zone()                 â”‚ â†’ zona_hotelera|centro|region_237|...
â”‚ â”œâ”€ clientOrigin()         â”‚ â†’ CDMX|Cancun_Local|...
â”‚ â”œâ”€ income()               â”‚ â†’ alto|medio|bajo
â”‚ â”œâ”€ age()                  â”‚ â†’ 18-25|26-35|...|65+
â”‚ â””â”€ amount()               â”‚ â†’ number
â”‚                            â”‚
â”‚ Methods:                   â”‚
â”‚ â”œâ”€ detectField(header)    â”‚ Detect CSV column
â”‚ â”œâ”€ normalizeRecords(data) â”‚ Batch normalize
â”‚ â””â”€ generateMappingReport()â”‚ Validation report
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
        â”‚ uses
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ processData(rawData)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Map headers              â”‚
â”‚ â€¢ Normalize values         â”‚
â”‚ â€¢ Track problems           â”‚
â”‚ â€¢ Populate window.salesDataâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
        â”‚ calls
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleFiles(event)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Validate file            â”‚
â”‚ â€¢ Papa.parse(file)         â”‚
â”‚ â€¢ Call processData()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
        â”‚ triggered by
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSV File Input Element     â”‚
â”‚ id="csvFile"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CrossDimensionalAnalyzer   â”‚ (anÃ¡lisis.js)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Constructor(data):         â”‚
â”‚ â€¢ Parse dimensions         â”‚
â”‚ â€¢ Build matrices           â”‚
â”‚ â€¢ Calculate conversions    â”‚
â”‚                            â”‚
â”‚ Methods:                   â”‚
â”‚ â”œâ”€ generateDemographicMatrix()
â”‚ â”œâ”€ generateOriginMatrix()  â”‚
â”‚ â””â”€ generateCannibalization()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
        â”‚ initialized by
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ initCompleteAnalysis()     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Sync datos               â”‚
â”‚ â€¢ Create analyzer          â”‚
â”‚ â€¢ Render visualizations    â”‚
â”‚ â€¢ Setup listeners          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. FLUJO DE DATOS EN MEMORIA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        window Object                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ salesData: Array[...]  â† CSV data   â”‚
â”‚  â”œâ”€ [0]: {zona, pitch, result, ...} â”‚
â”‚  â”œâ”€ [1]: {zona, pitch, result, ...} â”‚
â”‚  â””â”€ [N]: {zona, pitch, result, ...} â”‚
â”‚                                     â”‚
â”‚ filteredData: Array[...]            â”‚
â”‚  â””â”€ Copy of salesData (puede cambiarâ”‚
â”‚     cuando se aplican filtros)      â”‚
â”‚                                     â”‚
â”‚ FieldMapper: Object                 â”‚
â”‚  â””â”€ NormalizaciÃ³n de campos         â”‚
â”‚                                     â”‚
â”‚ currentAnalyzer: Object             â”‚
â”‚  â””â”€ AnÃ¡lisis cruzado en vivo        â”‚
â”‚                                     â”‚
â”‚ currentAnalysisData: Object         â”‚
â”‚  â”œâ”€ originalCount                   â”‚
â”‚  â”œâ”€ normalizedCount                 â”‚
â”‚  â”œâ”€ dimensions: Object              â”‚
â”‚  â”‚  â”œâ”€ zones: [zona_hotelera, ...]  â”‚
â”‚  â”‚  â”œâ”€ pitches: [autoridad, ...]    â”‚
â”‚  â”‚  â”œâ”€ results: [successful, ...]   â”‚
â”‚  â”‚  â””â”€ origins: [CDMX, ...]         â”‚
â”‚  â””â”€ timestamp                       â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. MATRIZ DE CONVERSIÃ“N (SALIDA)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Autoridad  â”‚ Nostalgiaâ”‚ Escasez  â”‚ Comunidadâ”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Zona Hotelera     â”‚    72% âœ…   â”‚   45%    â”‚   68%    â”‚   32%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Centro            â”‚    58%      â”‚   62% âœ… â”‚   51%    â”‚   44%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RegiÃ³n 237        â”‚    44%      â”‚   51%    â”‚   48%    â”‚   65% âœ… â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SM-77             â”‚    52%      â”‚   58%    â”‚   49%    â”‚   71% âœ… â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SM-91             â”‚    64%      â”‚   41%    â”‚   60% âœ… â”‚   38%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… = Mejor pitch para esa zona
```

---

**Diagrama completo del flujo del sistema - Ãºltima actualizaciÃ³n Enero 9, 2026**
